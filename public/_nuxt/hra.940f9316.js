import{q as C,u as B,r as i,s as A,o as s,c as o,a as t,v as e,t as h,x as j,y as L,z as V,A as b,B as F,C as P,d as D,b as H,w as Z,F as q,D as E,E as R,e as G,G as W}from"./entry.04dbe281.js";import{m as J}from"./marked.esm.14d91642.js";import{u as K}from"./fetch.db9540ed.js";const Q=["src"],X=["innerHTML"],Y={key:0},ee={key:1,class:"puzzle-action"},te=["href"],ne={key:0,class:"alert"},se={key:1},oe={key:0,class:"alert"},ae={key:2,colspan:"2"},le=["href"],ie={class:"success"},ue=C({__name:"puzzle",props:{puzzle:{type:Object,required:!0}},setup(S){const p=S,u=B(),d=i(""),k=i(!1),n=p.puzzle,c=i(n.state),f=i(n.url??""),w=i(n.solution??""),v=i(n.actions.unlocked??""),z=i(n.actions.solved??""),r=i(new Date(Date.now())),m=i(!1);n.nextAttempt&&(r.value=new Date(n.nextAttempt),x());function x(){r.value>new Date(Date.now())?(m.value=!0,setTimeout(()=>{x()},1e4)):m.value=!1}n.description=J(n.description,{mangle:!1,headerIds:!1});const T=A(()=>v?g(new Date(v.value)):null),U=A(()=>z?g(new Date(z.value)):null),I=A(()=>r?g(r.value):null);async function O(_){const a={state:"open",puzzleStateId:_,teamId:u.team.id,puzzleId:n.id},l=await $fetch("/api/update-puzzle-state/",{method:"POST",body:a,headers:{Authorization:`Bearer ${u.jwt}`}});v.value=l.actionsUpdates.unlocked,f.value=l.puzzleUpdates.url,c.value=l.puzzleUpdates.state}async function M(_){try{const a={state:"solved",solution:d.value,puzzleStateId:_,teamId:u.team.id,puzzleId:n.id},l=await $fetch("/api/update-puzzle-state/",{method:"POST",body:a,headers:{Authorization:`Bearer ${u.jwt}`}});z.value=l.actionsUpdates.solved,w.value=l.puzzleUpdates.solution,c.value=l.puzzleUpdates.state}catch(a){if(a.statusCode===400){const $=(await $fetch("/api/team-actions",{headers:{Authorization:`Bearer ${u.jwt}`}})).filter(y=>y.puzzleId===n.id&&y.action==="failed").sort((y,N)=>N.id-y.id);$.length>=2&&(r.value=new Date(new Date($[0].timestamp).setMinutes(new Date($[0].timestamp).getMinutes()+10)),x()),k.value=!0}}finally{d.value=""}}function g(_){return _.toLocaleString("cs-CZ",{weekday:"long",hour:"numeric",minute:"numeric"})}return(_,a)=>(s(),o("tr",null,[t("td",null,[t("img",{src:e(n).logoUrl},null,8,Q)]),t("td",null,[t("span",{innerHTML:e(n).description},null,8,X)]),e(c)==="locked"?(s(),o("td",Y,[t("button",{onClick:a[0]||(a[0]=l=>O(e(n).stateId))},"Odemknout")])):e(c)==="open"?(s(),o("td",ee,[t("div",null,[t("div",null,[t("a",{href:e(f)},"Zadání",8,te)]),t("div",null,"Odemčeno: "+h(e(T)),1),e(m)?(s(),o("div",ne,"Další pokus bude možný až v "+h(e(I)),1)):(s(),o("div",se,[j(t("input",{id:"solution","onUpdate:modelValue":a[1]||(a[1]=l=>V(d)?d.value=l:null),type:"text",placeholder:"Odpověď"},null,512),[[L,e(d)]]),e(k)?(s(),o("div",oe,"Řešení není správně.")):b("",!0),t("button",{onClick:a[2]||(a[2]=F(l=>M(e(n).stateId),["prevent"]))},"Odevzdat")]))])])):e(c)==="solved"?(s(),o("td",ae,[t("div",null,[t("div",null,[t("a",{href:e(f)},"Zadání",8,le)]),t("div",null,"Odemčeno: "+h(e(T)),1),t("div",ie,"Vyřešeno: "+h(e(U)),1),t("div",null,"Řešení: "+h(e(w)),1)])])):b("",!0)]))}});const de={key:0},ce={key:1},re={key:0},pe={key:1},me={key:2},he=C({__name:"hra",async setup(S){let p,u;const d=B(),n=R().public.gameFinished,{data:c}=([p,u]=P(()=>K("/api/puzzles",{headers:{Authorization:`Bearer ${d.jwt}`}},"$tdW7L5n1Ae")),p=await p,u(),p);return(f,w)=>{var r;const v=G,z=ue;return e(n)?(s(),o("div",de," Hra skončila, už není možné odpovídat. ")):(s(),o("div",ce,[e(d).team?((r=e(c))==null?void 0:r.length)==0?(s(),o("div",pe," Hra ještě nezačala. ")):(s(),o("table",me,[t("tbody",null,[(s(!0),o(q,null,E(e(c),m=>(s(),W(z,{key:m.id,puzzle:m},null,8,["puzzle"]))),128))])])):(s(),o("div",re,[t("p",null,[D("Musíte se "),H(v,{to:"/tym"},{default:Z(()=>[D("přihlásit")]),_:1})]),D(". ")]))]))}}});export{he as default};
